var Perfetto=new function(){this.init=function(){this.generateUI();this.getOptions();this.fillOptions();this.bind([this.c.lock],"click",this.proxy("toggleLock"));this.bind([this.c.show],"click",this.proxy("toggleShow"));this.bind([this.c.close],"click",this.proxy("toggleEntry"));this.bind([this.c.url,this.c.position.x,this.c.position.y,this.c.opacity,this.c.zIndex],"keyup",this.proxy("updateOptions"));this.bind([this.c.position.x,this.c.position.y,this.c.opacity,this.c.zIndex],"keydown",this.proxy("valueChange"));
    this.bind([this.c.head,this.layer],"mousedown",this.proxy("dragTo"));this.bind([this.c.head,this.layer],"dragstart",function(a){a.preventDefault()})};this.generateUI=function(){this.pf=document.createElement("div");this.pf.className=this.o.namespaces.wrapper;this.pf.innerHTML='<div class="pf_head" data-pf="head"><ul class="pf_layer-control"><li data-pf="show" class="pf_icon __off"></li><li data-pf="lock" class="pf_icon __unlock"></li></ul><h3 data-pf="close" class="pf_title">Perfetto</h3></div><div data-pf="entry" class="pf_entry __visible"><form action="#" class="pf_form"><fieldset class="pf_field_wrap"><div class="pf_field"><label>URL</label><input type="text" name="url"/></div></fieldset><fieldset class="pf_field_group"><div class="pf_field __first"><label>X</label><input type="text" name="pos-x"/></div><div class="pf_field"><label>Y</label><input type="text" name="pos-y"/></div></fieldset><fieldset class="pf_field_group"><div class="pf_field __first"><label>Opacity</label><input type="text" name="opacity"/></div><div class="pf_field"><label>z-Index</label><input type="text" name="zindex"/></div></fieldset></form></div>';
    this.layer=document.createElement("div");this.layer.className=this.o.namespaces.layer;this.c={head:this.pf.querySelector('[data-pf="head"]'),show:this.pf.querySelector('[data-pf="show"]'),lock:this.pf.querySelector('[data-pf="lock"]'),close:this.pf.querySelector('[data-pf="close"]'),entry:this.pf.querySelector('[data-pf="entry"]'),url:this.pf.querySelector('[name="url"]'),position:{x:this.pf.querySelector('[name="pos-x"]'),y:this.pf.querySelector('[name="pos-y"]')},opacity:this.pf.querySelector('[name="opacity"]'),
        zIndex:this.pf.querySelector('[name="zindex"]')};document.body.appendChild(this.pf);document.body.appendChild(this.layer)};this.saveOptions=function(){localStorage.Perfetto=!0;localStorage["Perfetto.o.position"]=this.o.position;localStorage["Perfetto.o.close"]=this.o.close;localStorage["Perfetto.o.layer.current"]=this.o.layer.current;localStorage["Perfetto.o.layer.show"]=this.o.layer.show;localStorage["Perfetto.o.layer.lock"]=this.o.layer.lock;localStorage["Perfetto.o.layer.url"]=this.o.layer.url;
    localStorage["Perfetto.o.layer.position"]=this.o.layer.position;localStorage["Perfetto.o.layer.opacity"]=this.o.layer.opacity;localStorage["Perfetto.o.layer.zIndex"]=this.o.layer.zIndex};this.getOptions=function(){if("true"===localStorage.Perfetto){var a=localStorage["Perfetto.o.position"].split(","),b=localStorage["Perfetto.o.layer.position"].split(",");this.o.position=[parseInt(a[0]),parseInt(a[1])];this.o.close="true"===localStorage["Perfetto.o.close"];this.o.layer.current=parseInt(localStorage["Perfetto.o.layer.current"]);
    this.o.layer.show="true"===localStorage["Perfetto.o.layer.show"];this.o.layer.lock="true"===localStorage["Perfetto.o.layer.lock"];this.o.layer.url=localStorage["Perfetto.o.layer.url"];this.o.layer.position=[parseInt(b[0]),parseInt(b[1])];this.o.layer.opacity=parseFloat(localStorage["Perfetto.o.layer.opacity"]);this.o.layer.zIndex=parseInt(localStorage["Perfetto.o.layer.zIndex"])}};this.fillOptions=function(){this.pf.style.left=this.o.position[0]+"px";this.pf.style.top=this.o.position[1]+"px ";this.o.close?
    this.toggleEntryToHidden():this.toggleEntryToVisible();this.o.layer.show?this.toggleShowToVisible():this.toggleShowToHidden();this.o.layer.lock?this.toggleLockToLocked():this.toggleLockToUnlocked();this.c.url.value=this.o.layer.url;this.changeURL();this.c.position.x.value=this.o.layer.position[0];this.c.position.y.value=this.o.layer.position[1];this.changePosition();this.c.opacity.value=this.o.layer.opacity;this.changeOpacity();this.c.zIndex.value=this.o.layer.zIndex;this.changeZIndex()};this.updateOptions=
    function(a){switch(a.currentTarget.name){case "url":this.o.layer.url=this.c.url.value;this.changeURL();break;case "pos-x":this.o.layer.position[0]=this.c.position.x.value;this.changePosition();break;case "pos-y":this.o.layer.position[1]=this.c.position.y.value;this.changePosition();break;case "opacity":this.o.layer.opacity=this.c.opacity.value;this.changeOpacity();break;case "zindex":this.o.layer.zIndex=this.c.zIndex.value,this.changeZIndex()}this.saveOptions()};this.valueChange=function(a){38==a.keyCode?
    "opacity"==a.currentTarget.name?(a=10*a.currentTarget.value+1,10<a&&(a=10),this.c.opacity.value=a/10):"pos-x"==a.currentTarget.name||"pos-y"==a.currentTarget.name?this.o.layer.lock||a.currentTarget.value++:a.currentTarget.value++:40==a.keyCode&&("opacity"==a.currentTarget.name?(a=10*a.currentTarget.value-1,0>a&&(a=0),this.c.opacity.value=a/10):"pos-x"==a.currentTarget.name||"pos-y"==a.currentTarget.name?this.o.layer.lock||a.currentTarget.value--:a.currentTarget.value--)};this.dragTo=function(a){var b=
    this,c=a.currentTarget;c==this.c.head&&(c=this.pf);if(c.className!=b.o.namespaces.layer||c.className==b.o.namespaces.layer&&!b.o.layer.lock){var d=a.pageX-c.offsetLeft,e=a.pageY-c.offsetTop,g=function(a){var f=a.pageX-d;a=a.pageY-e;c.style.left=f+"px";c.style.top=a+"px";c.className==b.o.namespaces.wrapper&&(b.o.position[0]=f,b.o.position[1]=a);c.className==b.o.namespaces.layer&&(b.c.position.x.value=b.o.layer.position[0]=f,b.c.position.y.value=b.o.layer.position[1]=a);b.saveOptions()},h=function(){b.unbind([document],
    "mousemove",g);b.unbind([document],"mouseup",h)};b.bind([document],"mousemove",g);b.bind([document],"mouseup",h)}};this.toggleLock=function(){this.o.layer.lock?(this.toggleLockToUnlocked(),this.o.layer.lock=!1):(this.toggleLockToLocked(),this.o.layer.lock=!0);this.saveOptions()};this.toggleLockToLocked=function(){this.removeClass(this.c.lock,"__unlock");this.addClass(this.c.lock,"__lock")};this.toggleLockToUnlocked=function(){this.removeClass(this.c.lock,"__lock");this.addClass(this.c.lock,"__unlock")};
    this.toggleShow=function(){this.o.layer.show?(this.toggleShowToHidden(),this.o.layer.show=!1):(this.toggleShowToVisible(),this.o.layer.show=!0);this.saveOptions()};this.toggleShowToVisible=function(){this.removeClass(this.c.show,"__off");this.addClass(this.c.show,"__on");this.layer.style.display="block"};this.toggleShowToHidden=function(){this.removeClass(this.c.show,"__on");this.addClass(this.c.show,"__off");this.layer.style.display="none"};this.toggleEntry=function(){this.o.close?(this.toggleEntryToVisible(),
        this.o.close=!1):(this.toggleEntryToHidden(),this.o.close=!0);this.saveOptions()};this.toggleEntryToVisible=function(){this.addClass(this.c.entry,"__visible");this.c.entry.style.display="block"};this.toggleEntryToHidden=function(){this.removeClass(this.c.entry,"__visible");this.c.entry.style.display="none"};this.changeURL=function(){this.layer.innerHTML='<img src="'+this.o.layer.url+'"/>';this.layer.style.backgroundImage="url("+this.o.layer.url+")"};this.changePosition=function(){this.layer.style.left=
        this.o.layer.position[0]+"px";this.layer.style.top=this.o.layer.position[1]+"px"};this.changeOpacity=function(){this.layer.style.opacity=this.o.layer.opacity};this.changeZIndex=function(){this.layer.style.zIndex=this.o.layer.zIndex};this.hasClass=function(a,b){return(new RegExp(" "+b+" ")).test(" "+a.className+" ")};this.addClass=function(a,b){this.hasClass(a,b)||(a.className+=" "+b)};this.removeClass=function(a,b){var c=" "+a.className.replace(/[\t\r\n]/g," ")+" ";if(this.hasClass(a,b)){for(;0<=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              c.indexOf(" "+b+" ");)c=c.replace(" "+b+" "," ");a.className=c.replace(/^\s+|\s+$/g,"")}};this.bind=function(a,b,c){for(var d=0;d<a.length;d++)a[d].addEventListener?a[d].addEventListener(b,c):a[d].attachEvent("on"+b,c)};this.unbind=function(a,b,c){for(var d=0;d<a.length;d++)a[d].removeEventListener?a[d].removeEventListener(b,c):a[d].detachEvent("on"+b,c)};this.proxy=function(a,b,c){c=c||this;b=b||[];"string"==typeof a&&(a=c[a]);return function(){for(var d=b.slice(),e=0;e<arguments.length;e++)if("undefined"==
        typeof d[e]||null===d[e])d[e]=arguments[e];return a.apply(c,d)}};this.o={namespaces:{wrapper:"pf",layer:"pf_layer"},position:[15,15],close:!1,layer:{current:0,show:!0,lock:!1,url:"/perfetto/layers/index.jpg",position:[0,0],opacity:1,zIndex:1E3}};this.init()};